<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShonenMaster</title>
    <meta name="description"
        content="Le meilleur quiz d'Anime/Manga en temps r√©el ! Affronte d'autres utilisateurs, grimpe le classement et deviens le ShonenMaster ultime.">
    <link rel="stylesheet" href="home.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap"
        rel="stylesheet">

    <link rel="icon" type="image/png" href="icon.png">
    <link rel="shortcut icon" type="image/png" href="icon.png">

    <!-- Pour Apple/iOS -->
    <link rel="apple-touch-icon" href="icon.png">

    <!-- Pour les r√©sultats de recherche Google (optionnel) -->
    <meta property="og:image" content="icon.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

</head>

<body>
    <div id="app" v-cloak>

        <!-- Particles Background -->
        <div id="particles-js"></div>

        <!-- Main Container -->
        <div class="main-container">
            <!-- Logo & Title (Non connect√© et jeu non actif) -->
            <div class="header-section welcome-screen" v-if="!isAuthenticated && !gameInProgress">
                <h1 class="logo-title">
                    <span class="neon-text">Shonen</span><span class="neon-text-alt">Master</span>
                </h1>

                <button class="btn-primary btn-twitch floating" @click="loginTwitch">
                    <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                        <path
                            d="M11.571 4.714h1.715v5.143H11.57zm4.715 0H18v5.143h-1.714zM6 0L1.714 4.286v15.428h5.143V24l4.286-4.286h3.428L22.286 12V0zm14.571 11.143l-3.428 3.428h-3.429l-3 3v-3H6.857V1.714h13.714Z" />
                    </svg>
                    <span>Se connecter avec Twitch</span>
                </button>
            </div>

            <!-- Logo simplifi√© (Utilisateur authentifi√© uniquement) -->
            <div class="header-section" v-if="isAuthenticated && !gameInProgress">
                <h1 class="logo-title">
                    <!-- <span class="neon-text">Shonen</span><span class="neon-text-alt">Master</span> -->
                </h1>
                <div class="live-badge" v-if="isGameActive">
                    <span class="pulse-dot"></span>
                    <span>EN LIVE</span>
                </div>
            </div>

            <!-- √âtat: Connect√© mais jeu non activ√© -->
            <div class="content-section" v-if="!isGameActive && isAuthenticated">
                <div class="info-card">
                    <!-- Coins d√©coratifs -->
                    <div class="corner-decoration corner-tl"></div>
                    <div class="corner-decoration corner-tr"></div>
                    <div class="corner-decoration corner-bl"></div>
                    <div class="corner-decoration corner-br"></div>

                    <div class="user-welcome">
                        <div class="avatar-icon">üë§</div>
                        <div>
                            <p class="welcome-text">Bienvenue,</p>
                            <h3 class="username">{{ username }}</h3>
                        </div>
                    </div>

                    <div class="separator"></div>

                    <h2>En pr√©paration...</h2>
                    <p>La partie commence bient√¥t !</p>

                    <!-- Katana Slash Loader -->
                    <div class="katana-container">
                        <div class="katana-line"></div>
                    </div>
                </div>

                <button class="btn-secondary" @click="logout">
                    D√©connexion
                </button>
            </div>

            <!-- √âtat: Lobby (jeu activ√©, en attente) -->
            <div class="content-section" v-if="isGameActive && !gameInProgress && isAuthenticated && !gameStartedOnServer">

                <!-- Mode Rivalit√©: Modal choix d'√©quipe -->
                <div class="rivalry-modal" v-if="lobbyMode === 'rivalry'">
                    <div class="rivalry-modal-title">{{ hasJoined ? (selectedTeam === 1 ? teamNames[1] : teamNames[2]) : 'Rivalit√©' }}</div>
                    <div class="rivalry-modal-subtitle">{{ hasJoined ? 'En attente du lancement...' : 'Choisis ton camp' }}</div>
                    <div class="rivalry-teams">
                        <div 
                            class="rivalry-team-card team-blue" 
                            :class="{ selected: selectedTeam === 1, disabled: hasJoined && selectedTeam !== 1 }"
                            @click="selectAndJoinTeam(1)"
                        >
                            <svg class="rivalry-team-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M6 3h12l4 6-10 13L2 9l4-6z"/>
                                <path d="M2 9h20"/>
                                <path d="M10 3l-4 6 6 13 6-13-4-6"/>
                            </svg>
                            <div class="rivalry-team-name">{{ teamNames[1] }}</div>
                            <div class="rivalry-team-count">{{ teamCounts[1] }} joueur{{ teamCounts[1] > 1 ? 's' : '' }}</div>
                        </div>
                        <div 
                            class="rivalry-team-card team-gold" 
                            :class="{ selected: selectedTeam === 2, disabled: hasJoined && selectedTeam !== 2 }"
                            @click="selectAndJoinTeam(2)"
                        >
                            <svg class="rivalry-team-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2"/>
                                <line x1="12" y1="22" x2="12" y2="2"/>
                            </svg>
                            <div class="rivalry-team-name">{{ teamNames[2] }}</div>
                            <div class="rivalry-team-count">{{ teamCounts[2] }} joueur{{ teamCounts[2] > 1 ? 's' : '' }}</div>
                        </div>
                    </div>
                </div>

                <!-- Mode Classic: Lobby card standard -->
                <div class="lobby-card" v-if="lobbyMode === 'classic'">
                    <!-- Coins d√©coratifs -->
                    <div class="corner-decoration corner-tl"></div>
                    <div class="corner-decoration corner-tr"></div>
                    <div class="corner-decoration corner-bl"></div>
                    <div class="corner-decoration corner-br"></div>

                    <h2>La partie va commencer...</h2>
                    
                    <!-- Mode Classic: Compteur de joueurs -->
                    <div class="players-box">
                        <span class="players-count">{{ playerCount }}</span>
                        <img src="people5.png" alt="Joueurs" class="players-icon">
                    </div>

                    <button 
                        class="btn-primary" 
                        :class="{ joined: hasJoined }"
                        @click="joinLobby" 
                        :disabled="hasJoined"
                    >
                        {{ hasJoined ? 'Vous √™tes dans la partie !' : 'Rejoindre la partie' }}
                    </button>
                </div>

                <button class="btn-secondary" @click="logout">
                    D√©connexion
                </button>
            </div>

            <!-- √âtat: Spectateur (partie en cours mais pas rejoint) -->
            <div class="content-section"
                v-if="gameStartedOnServer && !gameInProgress && isGameActive && isAuthenticated">
                <div class="info-card spectator-card">
                    <div class="spectator-icon">‚è≥</div>
                    <h2>Partie en cours</h2>
                    <p>Une partie est actuellement en cours.</p>
                    <p class="small-text">Veuillez patienter jusqu'√† la prochaine partie pour rejoindre le jeu.</p>
                </div>

                <button class="btn-secondary" @click="logout">
                    D√©connexion
                </button>
            </div>

            <!-- √âtat: Partie en cours -->
            <div class="content-section game-section" v-if="gameInProgress && isAuthenticated && !gameEnded">
                <!-- HUD du joueur -->
                <div class="player-hud">
                    <div class="hud-item hud-username-item">
                        <span class="hud-value">{{ username }}</span>
                        <!-- üÜï Badge √©quipe en mode Rivalit√© -->
                        <span class="hud-team-badge" v-if="lobbyMode === 'rivalry' && selectedTeam" 
                              :class="'team-' + selectedTeam">
                            {{ teamNames[selectedTeam] }}
                        </span>
                    </div>

                    <!-- üÜï Affichage conditionnel selon le mode -->
                    <div class="hud-item" v-if="gameMode === 'lives'">
                        <div class="hearts">
                            <span v-for="n in 3" :key="n" class="heart" :class="{ lost: n > playerLives }">
                                {{ n <= playerLives ? '‚ù§Ô∏è' : 'üñ§' }} </span>
                        </div>
                    </div>

                    <div class="hud-item points-display" v-if="gameMode === 'points'">
                        <div class="points-counter">
                            <!-- <span class="points-icon">‚≠ê</span> -->
                            <span class="points-number">{{ formattedPlayerPoints }}</span>
                        </div>
                    </div>

                    <div class="hud-item">
                        <span class="hud-value">Question {{ currentQuestionNumber }}</span>
                    </div>


                    <transition name="shield-icon-fade">
                        <img v-if="activeBonusEffect === 'shield'" src="shield.png" alt="Shield"
                            class="hud-shield-icon">
                    </transition>

                    <transition name="x2-icon-fade">
                        <img v-if="activeBonusEffect === 'doublex2'" src="x2.png" alt="Points x2" class="hud-x2-icon">
                    </transition>
                </div>

                <!-- üÜï Animation +X points -->
                <div class="points-animation-container" v-if="pointsAnimation">
                    <div class="points-gained">+{{ pointsGained }} </div>
                </div>

                <!-- üÜï Conteneur fixe pour √©viter d√©calages -->
                <div class="question-container-wrapper">
                    <!-- üÜï Barre de timer horizontale ultra-fine (toujours pr√©sente pour √©viter les d√©calages) -->
                    <div class="timer-bar-container" :class="{ hidden: !currentQuestion || showResults }">
                        <div class="timer-bar-progress" :style="{ width: timerProgress + '%' }"
                            :class="{ warning: timeRemaining <= 3 }"></div>
                    </div>

                    <!-- Question -->
                    <div class="question-card" v-if="currentQuestion && !showResults">
                        <!-- Badges s√©rie et difficult√© -->
                        <div class="question-badges">
                            <span class="serie-badge">{{ currentQuestion.serie }}</span>
                            <span class="difficulty-badge" :class="'diff-' + currentQuestion.difficulty">
                                {{ currentQuestion.difficulty.toUpperCase() }}
                            </span>


                        </div>

                        <!-- Question -->
                        <h3 class="question-text">{{ currentQuestion.question }}</h3>

                        <!-- R√©ponses -->
                        <div class="answers-grid" :class="{ 'grid-6': currentQuestion.answers.length === 6 }">
                            <button v-for="(answer, index) in currentQuestion.answers" :key="index" class="answer-btn"
                                :class="{ selected: selectedAnswer === index + 1, disabled: hasAnswered || playerLives === 0 }"
                                @click="selectAnswer(index + 1, $event)" :disabled="hasAnswered || playerLives === 0">
                                <span class="answer-number">{{ index + 1 }}</span>
                                <span class="answer-text">{{ answer }}</span>
                            </button>
                        </div>

                        <div class="answer-status" v-if="hasAnswered">
                            <div class="status-icon">‚úì</div>
                            <p>R√©ponse enregistr√©e !</p>
                        </div>

                        <div class="eliminated-notice" v-if="playerLives === 0">
                            <div class="skull-icon">üíÄ</div>
                            <h3>Vous √™tes √©limin√©</h3>
                            <p>Vous pouvez continuer √† regarder la partie</p>
                        </div>
                    </div>

                    <!-- üÜï R√âSULTATS - Question avec indicateurs visuels -->
                    <div class="question-card results-view" v-if="showResults && currentQuestion">
                        <!-- Badges s√©rie et difficult√© -->
                        <div class="question-badges">
                            <span class="serie-badge">{{ currentQuestion.serie }}</span>
                            <span class="difficulty-badge" :class="'diff-' + currentQuestion.difficulty">
                                {{ currentQuestion.difficulty.toUpperCase() }}
                            </span>

                        </div>

                        <!-- Question -->
                        <h3 class="question-text">{{ currentQuestion.question }}</h3>

                        <!-- R√©ponses avec indicateurs -->
                        <div class="answers-grid" :class="{ 'grid-6': currentQuestion.answers.length === 6 }">
                            <div v-for="(answer, index) in currentQuestion.answers" :key="index"
                                class="answer-btn result-answer" :class="{ 
                'correct': (index + 1) === questionResults.correctAnswer,
                'wrong': selectedAnswer === (index + 1) && selectedAnswer !== questionResults.correctAnswer,
                'unselected': selectedAnswer && selectedAnswer !== (index + 1) && (index + 1) !== questionResults.correctAnswer
            }">
                                <span class="answer-text">{{ answer }}</span>
                                <!-- <span class="result-icon" v-if="(index + 1) === questionResults.correctAnswer">‚úì</span> -->
                                <!-- <span class="result-icon wrong-icon"
                                    v-if="selectedAnswer === (index + 1) && selectedAnswer !== questionResults.correctAnswer">‚úï</span>
                             -->
                            </div>
                        </div>

                        <!-- Stats discr√®tes en bas -->
                        <div class="survivors-count" v-if="!questionResults.isTiebreaker && lobbyMode === 'classic'">
                            üë§ {{ questionResults.remainingPlayers }} restants
                        </div>
                        
                        <!-- üÜï Stats √©quipe du joueur en mode Rivalit√© - Style V6 Glow -->
                        <div class="my-team-score-wrapper" 
                             v-if="!questionResults.isTiebreaker && lobbyMode === 'rivalry' && selectedTeam"
                             :key="'team-score-' + currentQuestionNumber + '-' + showResults">
                            <div class="my-team-score animate-in" :class="'team-' + selectedTeam">
                                <span class="team-name">{{ teamNames[selectedTeam] }}</span>
                                <span class="team-separator"></span>
                                <span class="team-value">{{ teamScores[selectedTeam] }} {{ gameMode === 'lives' ? 'üë§' : '‚≠ê' }}</span>
                            </div>
                        </div>

                        <!-- üî• Message tiebreaker -->
                        <div class="survivors-count" v-if="questionResults.isTiebreaker"
                            style="color: var(--warning-color);">
                            ‚öîÔ∏è Tiebreaker en cours
                        </div>
                    </div>
                </div><!-- Fin question-container-wrapper -->
            </div>

            <!-- ============================================
            √âCRAN DE FIN - NOUVEAU PODIUM DESIGN
            ============================================ -->
            <div class="content-section gameover-section" v-if="gameEnded && podiumPlayers.length > 0">
                <!-- Particules de fond -->
                <div class="winner-particles" id="winnerParticles"></div>
                
                <!-- Explosions al√©atoires -->
                <div class="bg-explosions" id="bgExplosions"></div>

                <div class="winner-container">
                    <!-- Podium -->
                    <div class="winner-podium">
                        <!-- 2√®me (gauche) -->
                        <div class="podium-place second" v-if="podiumPlayers[1]">
                            <!-- Silver Medal -->
                            <div class="podium-medal">
                                <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22 8L32 28L42 8" stroke="#6B7280" stroke-width="12" stroke-linecap="round"/>
                                    <path d="M22 8L32 28L42 8" stroke="#C0C0C0" stroke-width="8" stroke-linecap="round"/>
                                    <circle cx="32" cy="40" r="20" fill="url(#silverGrad)" stroke="#6B7280" stroke-width="2"/>
                                    <circle cx="32" cy="40" r="14" fill="none" stroke="#6B7280" stroke-width="1" opacity="0.5"/>
                                    <path d="M32 30L34.5 36.5H41L35.75 40.5L38 47L32 43L26 47L28.25 40.5L23 36.5H29.5L32 30Z" fill="#6B7280"/>
                                    <defs>
                                        <linearGradient id="silverGrad" x1="12" y1="20" x2="52" y2="60">
                                            <stop offset="0%" stop-color="#E5E7EB"/>
                                            <stop offset="50%" stop-color="#FFFFFF"/>
                                            <stop offset="100%" stop-color="#9CA3AF"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                            </div>
                            <div class="podium-card" :class="{ 'team-card': podiumPlayers[1].isTeam, 'team-1': podiumPlayers[1].team === 1, 'team-2': podiumPlayers[1].team === 2 }">
                                <div class="podium-player-name">{{ podiumPlayers[1].username }}</div>
                                <div class="podium-stats single-stat">
                                    <div class="podium-stat" v-if="gameEndData.gameMode === 'lives' || gameEndData.gameMode === 'rivalry-lives'">
                                        <div class="podium-stat-val">
                                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                            {{ podiumPlayers[1].lives }}
                                        </div>
                                        <div class="podium-stat-label">{{ podiumPlayers[1].isTeam ? 'Vies √©quipe' : 'Vies' }}</div>
                                    </div>
                                    <div class="podium-stat" v-if="gameEndData.gameMode === 'points' || gameEndData.gameMode === 'rivalry-points'">
                                        <div class="podium-stat-val">{{ podiumPlayers[1].points || 0 }}</div>
                                        <div class="podium-stat-label">{{ podiumPlayers[1].isTeam ? 'Points √©quipe' : 'Points' }}</div>
                                    </div>
                                </div>
                            </div>
                            <div class="podium-step"></div>
                        </div>

                        <!-- 1er (centre) -->
                        <div class="podium-place first" v-if="podiumPlayers[0]">
                            <!-- Gold Medal -->
                            <div class="podium-medal">
                                <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22 8L32 28L42 8" stroke="#B8860B" stroke-width="12" stroke-linecap="round"/>
                                    <path d="M22 8L32 28L42 8" stroke="#FFD700" stroke-width="8" stroke-linecap="round"/>
                                    <circle cx="32" cy="40" r="20" fill="url(#goldGrad)" stroke="#B8860B" stroke-width="2"/>
                                    <circle cx="32" cy="40" r="14" fill="none" stroke="#B8860B" stroke-width="1" opacity="0.5"/>
                                    <path d="M32 30L34.5 36.5H41L35.75 40.5L38 47L32 43L26 47L28.25 40.5L23 36.5H29.5L32 30Z" fill="#B8860B"/>
                                    <defs>
                                        <linearGradient id="goldGrad" x1="12" y1="20" x2="52" y2="60">
                                            <stop offset="0%" stop-color="#FFD700"/>
                                            <stop offset="50%" stop-color="#FFF8DC"/>
                                            <stop offset="100%" stop-color="#F0C850"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                            </div>
                            <div class="podium-card" :class="{ 'team-card': podiumPlayers[0].isTeam, 'team-1': podiumPlayers[0].team === 1, 'team-2': podiumPlayers[0].team === 2 }">
                                <div class="podium-light-burst"></div>
                                <div class="podium-particle-burst" id="winnerBurst"></div>
                                <div class="podium-winner-content">
                                    <div class="podium-crown">
                                        <svg viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm14 3H5v2h14v-2z" fill="url(#crownGrad)"/>
                                            <defs>
                                                <linearGradient id="crownGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                                                    <stop offset="0%" style="stop-color:#FFD700"/>
                                                    <stop offset="50%" style="stop-color:#FFF"/>
                                                    <stop offset="100%" style="stop-color:#F0C850"/>
                                                </linearGradient>
                                            </defs>
                                        </svg>
                                    </div>
                                    <div class="podium-player-name">{{ podiumPlayers[0].username }}</div>
                                    <div class="podium-stats single-stat">
                                        <div class="podium-stat" v-if="gameEndData.gameMode === 'lives' || gameEndData.gameMode === 'rivalry-lives'">
                                            <div class="podium-stat-val">
                                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                                {{ podiumPlayers[0].lives }}
                                            </div>
                                            <div class="podium-stat-label">{{ podiumPlayers[0].isTeam ? 'Vies √©quipe' : 'Vies' }}</div>
                                        </div>
                                        <div class="podium-stat" v-if="gameEndData.gameMode === 'points' || gameEndData.gameMode === 'rivalry-points'">
                                            <div class="podium-stat-val">{{ podiumPlayers[0].points || 0 }}</div>
                                            <div class="podium-stat-label">{{ podiumPlayers[0].isTeam ? 'Points √©quipe' : 'Points' }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="podium-step"></div>
                        </div>

                        <!-- 3√®me (droite) -->
                        <div class="podium-place third" v-if="podiumPlayers[2]">
                            <!-- Bronze Medal -->
                            <div class="podium-medal">
                                <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22 8L32 28L42 8" stroke="#8B4513" stroke-width="12" stroke-linecap="round"/>
                                    <path d="M22 8L32 28L42 8" stroke="#CD853F" stroke-width="8" stroke-linecap="round"/>
                                    <circle cx="32" cy="40" r="20" fill="url(#bronzeGrad)" stroke="#8B4513" stroke-width="2"/>
                                    <circle cx="32" cy="40" r="14" fill="none" stroke="#8B4513" stroke-width="1" opacity="0.5"/>
                                    <path d="M32 30L34.5 36.5H41L35.75 40.5L38 47L32 43L26 47L28.25 40.5L23 36.5H29.5L32 30Z" fill="#8B4513"/>
                                    <defs>
                                        <linearGradient id="bronzeGrad" x1="12" y1="20" x2="52" y2="60">
                                            <stop offset="0%" stop-color="#CD853F"/>
                                            <stop offset="50%" stop-color="#DEB887"/>
                                            <stop offset="100%" stop-color="#B87333"/>
                                        </linearGradient>
                                    </defs>
                                </svg>
                            </div>
                            <div class="podium-card">
                                <div class="podium-player-name">{{ podiumPlayers[2].username }}</div>
                                <div class="podium-stats single-stat">
                                    <div class="podium-stat" v-if="gameEndData.gameMode === 'lives'">
                                        <div class="podium-stat-val">
                                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                            {{ podiumPlayers[2].lives }}
                                        </div>
                                        <div class="podium-stat-label">Vies</div>
                                    </div>
                                    <div class="podium-stat" v-if="gameEndData.gameMode === 'points'">
                                        <div class="podium-stat-val">{{ podiumPlayers[2].points || 0 }}</div>
                                        <div class="podium-stat-label">Points</div>
                                    </div>
                                </div>
                            </div>
                            <div class="podium-step"></div>
                        </div>
                    </div>

                    <!-- Ton classement (si hors top 3) -->
                    <div class="your-rank-section" v-if="myRank && myRank.rank > 3">
                        <div class="your-rank-position">
                            <span class="your-rank-number">{{ myRank.rank }}</span>
                            <span class="your-rank-suffix">{{ myRank.rank === 1 ? 'er' : '√®me' }}</span>
                        </div>
                        <div class="your-rank-divider"></div>
                        <div class="your-rank-info">
                            <span class="your-rank-name">{{ username }}</span>
                            <div class="your-rank-stats">
                                <span v-if="gameEndData.gameMode === 'lives'">
                                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                                    {{ myRank.lives }} vies
                                </span>
                                <span v-if="gameEndData.gameMode === 'points'">{{ myRank.points || 0 }} pts</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bouton Retour -->
                    <button class="btn-winner-back" @click="backToHome">Retour</button>
                </div>
            </div>
        </div>

        <!-- üÜï Badge EN LIVE discret en bas (pour utilisateurs NON connect√©s) -->
        <div class="live-badge-bottom" v-if="isGameActive && !isAuthenticated && !gameInProgress">
            <span class="pulse-dot-small"></span>
            <span>EN LIVE</span>
        </div>


        <!-- üÜï Bouton Profil (en haut √† droite, visible si connect√©) -->
        <button class="profile-btn" v-if="isAuthenticated && !gameInProgress" @click="openProfile">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
        </button>

        <!-- Tips informatifs (PC uniquement, visible si connect√© et pas en jeu) -->
        <div class="lobby-tips-container" v-if="isAuthenticated && !gameInProgress && currentTip">
            <div class="lobby-tip" :key="tipKey">
                <span class="tip-icon">üí°</span>
                <span class="tip-text">{{ currentTip }}</span>
            </div>
        </div>

        <!-- ============================================
             MODAL PROFIL ULTRA-ANIMATED
             ============================================ -->
        <div class="profile-overlay" :class="{ active: showProfileModal }" @click.self="closeProfile">
            <div class="profile-modal" ref="profileModal">
                <!-- Scan line -->
                <div class="profile-scan-line" ref="profileScanLine"></div>

                <!-- Coins d√©coratifs -->
                <div class="corner-decoration corner-tl"></div>
                <div class="corner-decoration corner-tr"></div>
                <div class="corner-decoration corner-bl"></div>
                <div class="corner-decoration corner-br"></div>

                <!-- Header -->
                <!-- Header avec Avatar -->
                <div class="profile-header">
                    <div class="profile-header-glow"></div>

                    <div class="profile-user-info">
                        <!-- Avatar avec anneau anim√© -->
                        <div class="profile-avatar-wrapper">
                            <div class="profile-avatar-ring"></div>
                            <!-- Si tu as l'URL Twitch dans profileData -->
                            <img v-if="profileData && profileData.user && profileData.user.avatar_url"
                                :src="profileData.user.avatar_url" :alt="username" class="profile-avatar-img">
                            <!-- Sinon, ic√¥ne par d√©faut -->
                            <div v-else class="profile-avatar-default">
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                </svg>
                            </div>
                        </div>

                        <span class="profile-username">{{ username }}</span>
                    </div>

                    <button class="profile-close-btn" @click="closeProfile">√ó</button>
                </div>

                <!-- Tabs -->
                <div class="profile-tabs" ref="profileTabs">
                    <button class="profile-tab-btn" :class="{ active: currentTab === 'profile' }"
                        @click="switchProfileTab('profile')" ref="tabProfile">Profil</button>
                    <button class="profile-tab-btn" :class="{ active: currentTab === 'badges' }"
                        @click="switchProfileTab('badges')" ref="tabBadges">Badges</button>
                    <button class="profile-tab-btn" :class="{ active: currentTab === 'titres' }"
                        @click="switchProfileTab('titres')" ref="tabTitres">Titres</button>
                    <button class="profile-tab-btn" :class="{ active: currentTab === 'avatar' }"
                        @click="switchProfileTab('avatar')" ref="tabAvatar">Avatar</button>
                    <div class="profile-tab-indicator" ref="profileTabIndicator"></div>
                </div>

                <!-- Content -->
                <div class="profile-content" v-if="profileData">
                    <!-- Tab Profil -->
                    <div class="profile-tab-panel" :class="{ active: currentTab === 'profile' }" ref="panelProfile">
                        <div class="profile-title-showcase" ref="titleShowcase">
                            <div class="profile-title-label">Titre actuel</div>
                            <div class="profile-title-value">{{ profileData.titles.current.title_name }}</div>
                        </div>
                        <div class="profile-stats-grid">
                            <div class="profile-stat-card" ref="statCard1" @click="rippleEffect($event)">
                                <div class="profile-stat-value">
                                    <span class="counter" ref="counterGames">0</span>
                                </div>
                                <div class="profile-stat-label">Parties jou√©es</div>
                            </div>
                            <div class="profile-stat-card" ref="statCard2" @click="rippleEffect($event)">
                                <div class="profile-stat-value">
                                    <span class="counter" ref="counterWins">0</span>
                                </div>
                                <div class="profile-stat-label">Victoires</div>
                            </div>
                            <div class="profile-stat-card" ref="statCard3" @click="rippleEffect($event)">
                                <div class="profile-stat-value">
                                    <span class="counter" ref="counterWinrate">0</span>%
                                </div>
                                <div class="profile-stat-label">Win Rate</div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Badges -->
                    <div class="profile-tab-panel" :class="{ active: currentTab === 'badges' }" ref="panelBadges">
                        <!-- Parties jou√©es -->
                        <div class="profile-badges-category" ref="badgesCat1">
                            <div class="profile-category-header">
                                <div class="profile-category-indicator"></div>
                                <span class="profile-category-title">Parties jou√©es</span>
                            </div>
                            <div class="profile-badges-grid">
                                <div v-for="badge in profileData.badges.games_played" :key="'gp-' + badge.tier"
                                    class="profile-badge-item"
                                    :class="{ unlocked: badge.unlocked, locked: !badge.unlocked }">
                                    <div class="profile-badge-icon">
                                        <span v-if="!badge.unlocked" class="profile-lock-symbol">üîí</span>
                                    </div>
                                    <span class="profile-badge-number">{{ badge.tier }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Parties gagn√©es -->
                        <div class="profile-badges-category" ref="badgesCat2">
                            <div class="profile-category-header">
                                <div class="profile-category-indicator"></div>
                                <span class="profile-category-title">Parties gagn√©es</span>
                            </div>
                            <div class="profile-badges-grid">
                                <div v-for="badge in profileData.badges.games_won" :key="'gw-' + badge.tier"
                                    class="profile-badge-item"
                                    :class="{ unlocked: badge.unlocked, locked: !badge.unlocked }">
                                    <div class="profile-badge-icon">
                                        <span v-if="!badge.unlocked" class="profile-lock-symbol">üîí</span>
                                    </div>
                                    <span class="profile-badge-number">{{ badge.tier }}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab Titres -->
                    <div class="profile-tab-panel" :class="{ active: currentTab === 'titres' }" ref="panelTitres">
                        <div class="profile-titles-list">
                            <div v-for="title in profileData.titles.unlocked" :key="title.id" class="profile-title-row"
                                :class="{ 
                                    equipped: title.id === profileData.titles.current.id, 
                                    locked: false 
                                }"
                                @click="title.id !== profileData.titles.current.id ? equipTitleAnimated(title.id, title.title_name) : null">
                                <div class="profile-title-info">
                                    <span class="profile-title-name">{{ title.title_name }}</span>
                                    <span class="profile-title-requirement">{{ title.requirement_value }} {{
                                        title.title_type === 'games_played' ? 'parties' : 'victoires' }}</span>
                                </div>
                                <span v-if="title.id === profileData.titles.current.id"
                                    class="profile-status-badge equipped">
                                    <span class="check-icon">‚úì</span> √âquip√©
                                </span>
                                <span v-else class="profile-status-badge equip">
                                    √âquiper
                                </span>
                            </div>
                        </div>
                    </div>


                    <!-- Tab Avatar -->
                    <div class="profile-tab-panel" :class="{ active: currentTab === 'avatar' }" ref="panelAvatar">
                        <!-- Avatar actuel -->
                        <div class="profile-current-avatar">
                            <div class="profile-avatar-preview">
                                <div class="profile-avatar-ring-large"></div>
                                <img v-if="profileData && profileData.user && profileData.user.avatar_url"
                                    :src="profileData.user.avatar_url" alt="Avatar actuel"
                                    class="profile-avatar-img-large">
                                <div v-else class="profile-avatar-default-large">
                                    <svg viewBox="0 0 24 24" fill="currentColor">
                                        <path
                                            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                                    </svg>
                                </div>
                            </div>
                            <!-- <span class="profile-avatar-label">Avatar actuel</span> -->
                        </div>

                        <!-- S√©parateur -->
                        <div class="profile-avatar-divider">
                            <span>Choisir un avatar</span>
                        </div>

                        <!-- Section Avatars par d√©faut -->
                        <!-- Section Avatars par d√©faut -->
                        <div class="profile-avatar-section" ref="avatarSectionDefault">
                            <div class="profile-avatar-section-header">
                                <span class="profile-avatar-section-icon">‚≠ê</span>
                                <span class="profile-avatar-section-title">Personnages</span>
                            </div>
                            <div class="profile-avatars-grid">
                                <div v-for="avatar in defaultAvatars" :key="avatar.id" class="profile-avatar-option"
                                    :class="{ 
                selected: profileData?.user?.avatar_url === avatar.url,
                locked: avatar.locked 
            }" @click="!avatar.locked && selectAvatar(avatar.url)">
                                    <img :src="avatar.url" :alt="avatar.name" class="profile-avatar-option-img">

                                    <!-- Badge s√©lectionn√© -->
                                    <div class="profile-avatar-selected-badge"
                                        v-if="profileData?.user?.avatar_url === avatar.url">
                                        <span class="check-icon">‚úì</span>
                                    </div>

                                    <!-- Cadenas si verrouill√© -->
                                    <div class="profile-avatar-lock" v-if="avatar.locked">
                                        <span>üîí</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading state -->
                <div class="profile-content" v-else>
                    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                        Chargement...
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast notification pour le profil -->
        <div class="profile-toast" ref="profileToast"></div>

        <!-- üÜï Bouton Toggle Leaderboard (mobile uniquement) -->
        <button class="leaderboard-toggle-btn" :class="{ hidden: showLeaderboard }"
            v-if="leaderboardLoaded && !isAuthenticated" @click="toggleLeaderboard">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path d="M7 7h10v2H7zm0 4h10v2H7zm0 4h10v2H7z" />
                <path d="M12 3L4 9v12h16V9l-8-6zm6 16H6V10l6-4.5L18 10v9z" />
            </svg>
        </button>

        <!-- üÜï Overlay sombre (mobile uniquement) -->
        <div class="leaderboard-overlay" :class="{ active: showLeaderboard }" @click="toggleLeaderboard"
            v-if="leaderboardLoaded && !isAuthenticated"></div>
        <!-- üÜï Leaderboard Panel (desktop toujours visible, mobile toggle) -->
        <div class="leaderboard-container" :class="{ 'mobile-open': showLeaderboard }"
            v-if="leaderboardLoaded && !isAuthenticated">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div class="leaderboard-title-wrapper">
                    <h3 class="leaderboard-title" style="margin-bottom: 0;">üèÜ Classement</h3>
                    <a href="/ranking" target="_blank" class="ranking-redirect-btn" title="Voir le classement complet">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                    </a>
                </div>
                <button class="leaderboard-close-btn" @click="toggleLeaderboard">‚úï</button>
            </div>
            <div class="leaderboard-list">
                <div v-for="(player, index) in leaderboard" :key="player.twitch_id" class="leaderboard-item"
                    :class="'rank-' + (index + 1)">
                    <span class="rank">{{ index + 1 }}</span>
                    <div class="player-info">
                        <span class="player-name">{{ player.username }}</span>
                        <span class="player-title">{{ player.title_name }}</span>
                    </div>
                    <span class="player-winrate">{{ player.win_rate }}%</span>
                </div>
            </div>
        </div>



        <!-- üÜï Bouton Instagram (visible uniquement avant connexion) -->
        <a href="https://www.instagram.com/naahas__" target="_blank" class="instagram-btn"
            v-if="!isAuthenticated && !gameInProgress">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                <path
                    d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
            </svg>
        </a>


        <!-- üÜï Bouton TikTok (visible uniquement avant connexion) -->
        <!-- <a href="https://www.tiktok.com/@naahas__" target="_blank" class="tiktok-btn" -->
        v-if="!isAuthenticated && !gameInProgress">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path
                d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z" />
        </svg>
        </a>



        <!-- üÜï SYST√àME DE COMBO & BONUS -->

        <!-- Jauge de Combo (Desktop uniquement - c√¥t√© droit) -->
        <div class="combo-gauge-container" v-if="gameInProgress && !gameEnded">
            <!-- üî• Particules EN DEHORS de la jauge -->
            <div class="combo-particles-external"></div>

            <div class="combo-gauge">
                <div class="combo-bar-wrapper">
                    <div class="combo-bar-bg">
                        <!-- Barre de progression -->
                        <div class="combo-bar-fill"
                            :style="isLevelingUp ? { height: '100%' } : { height: comboBarHeight + '%' }">
                        </div>
                    </div>
                </div>

                <!-- üî• MODIFI√â : Utiliser comboLevelDisplay au lieu de comboLevel -->
                <!-- üî• Afficher m√™me au niveau 3 pour montrer "MAX" -->
                <div class="combo-level-indicator" v-if="comboLevel > 0">
                    {{ comboLevelDisplay }}
                </div>
            </div>
        </div>

        <!-- üÜï NOUVEAU SYST√àME BONUS - Ic√¥ne + Hover Menu -->
        <div class="bonus-icon-container" v-if="gameInProgress && !gameEnded">
            <div class="bonus-icon-wrapper" @mouseenter="showBonusMenu = true" @mouseleave="showBonusMenu = false"
                @click="showBonusMenu = !showBonusMenu">

                <!-- Ic√¥ne principale -->
                <div class="bonus-main-icon" :class="{ active: hasUnusedBonuses }">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 2.18l8 3.6v8.55c0 4.65-3.2 8.95-8 10.05-4.8-1.1-8-5.4-8-10.05V7.78l8-3.6zM11 10v2h2v-2h-2zm0 4v6h2v-6h-2z" />
                    </svg>

                    <!-- Badge notification (seulement si bonus disponibles) -->
                    <span class="bonus-count-badge" v-if="hasUnusedBonuses && playerLives > 0">
                        {{ unusedBonusCount }}
                    </span>
                </div>

                <!-- Menu des bonus (3 bandelettes) - üî• REFONTE avec compteurs -->
                <transition name="bonus-menu">
                    <div class="bonus-menu" v-show="showBonusMenu" @click.stop>
                        <!-- Bonus 1 : 50/50 -->
                        <div class="bonus-strip" :class="[getBonusState('5050'), { disabled: !canUseBonus() }]"
                            @click="useBonusStrip('5050')">
                            <img src="5050.png" alt="50/50" class="bonus-icon-img">
                            <span class="bonus-strip-text">50/50</span>
                            <span class="bonus-strip-count">{{ bonusInventory['5050'] }}</span>
                        </div>

                        <!-- Bonus 2 : Joker -->
                        <div class="bonus-strip" :class="[getBonusState('reveal'), { disabled: !canUseBonus() }]"
                            @click="useBonusStrip('reveal')">
                            <img src="reveal2.png" alt="Joker" class="bonus-icon-img">
                            <span class="bonus-strip-text">Joker</span>
                            <span class="bonus-strip-count">{{ bonusInventory['reveal'] }}</span>
                        </div>

                        <!-- Bonus 3 : Points x2 / Shield -->
                        <div class="bonus-strip"
                            :class="[getBonusState(gameMode === 'lives' ? 'shield' : 'doublex2'), { disabled: !canUseBonus() }]"
                            @click="useBonusStrip(gameMode === 'lives' ? 'shield' : 'doublex2')">
                            <img :src="gameMode === 'lives' ? 'shield.png' : 'x2.png'"
                                :alt="gameMode === 'lives' ? 'Bouclier' : 'Points x2'" class="bonus-icon-img">
                            <span class="bonus-strip-text">{{ gameMode === 'lives' ? 'Bouclier' : 'Points x2' }}</span>
                            <span class="bonus-strip-count">{{ bonusInventory[gameMode === 'lives' ? 'shield' : 'doublex2'] }}</span>
                        </div>
                    </div>
                </transition>
            </div>
        </div>


        <!-- üÜï SYST√àME DE D√âFIS - Bandelettes √† gauche -->
        <div class="challenges-container" v-if="gameInProgress && !gameEnded && challenges.length > 0">
            <div class="challenge-strip" 
                 v-for="challenge in challenges" 
                 :key="challenge.id"
                 :class="{ completed: challenge.completed }">
                
                <!-- Ic√¥ne SVG selon le type de d√©fi -->
                <div class="challenge-icon">
                    <!-- √âclair (speed) -->
                    <svg v-if="challenge.id === 'speed3s'" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M7 2v11h3v9l7-12h-4l4-8z"/>
                    </svg>
                    <!-- Streak / Combo -->
                    <svg v-else-if="challenge.id.startsWith('streak')" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                    </svg>
                    <!-- Total -->
                    <svg v-else-if="challenge.id === 'total5'" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    <!-- Premier (first) -->
                    <svg v-else-if="challenge.id === 'first'" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    <!-- Difficult√© (hard/veryhard) -->
                    <svg v-else-if="challenge.id === 'hard' || challenge.id === 'veryhard'" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>
                    </svg>
                    <!-- S√©ries (series7) -->
                    <svg v-else-if="challenge.id === 'series7'" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                    </svg>
                    <!-- Default -->
                    <svg v-else viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                </div>
                
                <!-- Contenu du d√©fi -->
                <div class="challenge-content">
                    <div class="challenge-title">{{ challenge.name }}</div>
                    <div class="challenge-desc">{{ challenge.description }}</div>
                    <!-- Barre de progression -->
                    <div class="challenge-progress-bar" v-if="challenge.target > 1 && !challenge.completed">
                        <div class="challenge-progress-fill" 
                             :style="{ width: Math.min(100, (challenge.progress / challenge.target) * 100) + '%' }">
                        </div>
                    </div>
                </div>
                
                <!-- R√©compense -->
                <div class="challenge-reward">
                    <span class="reward-text">{{ getBonusName(challenge.reward) }}</span>
                </div>
                
                <!-- Checkbox completion -->
                <div class="challenge-checkbox">
                    <svg v-if="challenge.completed" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                </div>
            </div>
        </div>


        <!-- üÜï BONUS MOBILE - Ic√¥ne avec jauge circulaire (mobile uniquement) -->
        <div class="bonus-gauge-mobile" v-if="gameInProgress && !gameEnded" @click="toggleBonusArcMobile">

            <!-- SVG Gauge -->
            <svg class="gauge-svg" viewBox="0 0 68 68">
                <circle class="gauge-circle-bg" cx="34" cy="34" r="30"></circle>
                <circle class="gauge-circle-progress" cx="34" cy="34" r="30"
                    :style="{ strokeDashoffset: gaugeCircleOffset }"></circle>
            </svg>

            <!-- Ic√¥ne centrale -->
            <div class="gauge-icon-center" :class="{ active: hasUnusedBonuses }">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M12 2L2 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-10-5zm0 2.18l8 3.6v8.55c0 4.65-3.2 8.95-8 10.05-4.8-1.1-8-5.4-8-10.05V7.78l8-3.6zM11 10v2h2v-2h-2zm0 4v6h2v-6h-2z" />
                </svg>

                <span class="gauge-count-badge" v-if="hasUnusedBonuses && playerLives > 0">
                    {{ unusedBonusCount }}
                </span>
            </div>

            <!-- Particules (spawn apr√®s bonne r√©ponse) -->
            <div class="gauge-particles-mobile"></div>
        </div>

        <!-- üÜï Menu Arc de Cercle -->
        <div class="bonus-arc-menu" v-if="gameInProgress && !gameEnded">
            <!-- Overlay en premier (nth-child(1)) -->
            <div class="bonus-arc-overlay" :class="{ active: showBonusArcMobile }" @click="closeBonusArcMobile"></div>

            <!-- 50/50 (nth-child(2)) -->
            <div class="bonus-arc-item" :class="[getBonusState('5050'), { show: showBonusArcMobile }]"
                @click="useBonusArcMobile('5050')">
                <img src="5050.png" alt="50/50">
                <span class="bonus-arc-count" v-if="bonusInventory['5050'] > 0">x{{ bonusInventory['5050'] }}</span>
            </div>

            <!-- Joker (nth-child(3)) -->
            <div class="bonus-arc-item" :class="[getBonusState('reveal'), { show: showBonusArcMobile }]"
                @click="useBonusArcMobile('reveal')">
                <img src="reveal2.png" alt="Joker">
                <span class="bonus-arc-count" v-if="bonusInventory['reveal'] > 0">x{{ bonusInventory['reveal'] }}</span>
            </div>

            <!-- Shield/x2 (nth-child(4)) -->
            <div class="bonus-arc-item"
                :class="[getBonusState(gameMode === 'lives' ? 'shield' : 'doublex2'), { show: showBonusArcMobile }]"
                @click="useBonusArcMobile(gameMode === 'lives' ? 'shield' : 'doublex2')">
                <img :src="gameMode === 'lives' ? 'shield.png' : 'x2.png'"
                    :alt="gameMode === 'lives' ? 'Bouclier' : 'Points x2'">
                <span class="bonus-arc-count" v-if="bonusInventory[gameMode === 'lives' ? 'shield' : 'doublex2'] > 0">x{{ bonusInventory[gameMode === 'lives' ? 'shield' : 'doublex2'] }}</span>
            </div>
        </div>


        <!-- üÜï D√âFIS MOBILE - Ic√¥ne en bas gauche -->
        <div class="challenges-mobile-icon" v-if="gameInProgress && !gameEnded && challenges.length > 0" 
             @click="showChallengesMobile = !showChallengesMobile">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <!-- Badge nombre de d√©fis non compl√©t√©s -->
            <span class="challenges-mobile-badge" v-if="challenges.filter(c => !c.completed).length > 0">
                {{ challenges.filter(c => !c.completed).length }}
            </span>
        </div>

        <!-- üÜï D√âFIS MOBILE - Modal centr√© -->
        <transition name="challenges-modal">
            <div class="challenges-mobile-overlay" v-if="showChallengesMobile" @click="showChallengesMobile = false">
                <div class="challenges-mobile-modal" @click.stop>
                    <div class="challenges-mobile-header">
                        <button class="challenges-mobile-close" @click="showChallengesMobile = false">‚úï</button>
                    </div>
                    <div class="challenges-mobile-list">
                        <div class="challenge-mobile-item" 
                             v-for="challenge in challenges" 
                             :key="challenge.id"
                             :class="{ completed: challenge.completed }">
                            <div class="challenge-mobile-left">
                                <div class="challenge-mobile-name">{{ challenge.name }}</div>
                                <div class="challenge-mobile-desc">{{ challenge.description }}</div>
                                <div class="challenge-mobile-progress-bar" v-if="challenge.target > 1">
                                    <div class="challenge-mobile-progress-fill" 
                                         :style="{ width: Math.min(100, (challenge.progress / challenge.target) * 100) + '%' }">
                                    </div>
                                </div>
                            </div>
                            <div class="challenge-mobile-right">
                                <span class="challenge-mobile-reward">+{{ getBonusName(challenge.reward) }}</span>
                                <div class="challenge-mobile-check" v-if="challenge.completed">‚úì</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>


        <!-- Panel Streamers Partenaires -->
        <div class="streamers-panel" v-if="!isAuthenticated && !gameInProgress">
            <div class="streamers-trigger"></div>
            <div class="streamers-content">
                <div class="streamers-title"></div>
                <div class="streamers-list">
                    <!-- 5 premiers streamers -->
                    <a v-for="streamer in visibleStreamers" :key="streamer.id"
                        :href="'https://www.twitch.tv/' + streamer.id" target="_blank" class="streamer-item"
                        :class="{ 'is-live': streamersLive[streamer.id] }">
                        <div class="streamer-avatar-wrapper">
                            <img :src="streamer.avatar" :alt="streamer.name" class="streamer-avatar">
                            <span class="live-badge-small" v-if="streamersLive[streamer.id]">LIVE</span>
                        </div>
                        <span class="streamer-name">{{ streamer.name }}</span>
                    </a>

                    <!-- Badge +X si plus de 5 streamers -->
                    <div class="streamer-item streamer-more" v-if="hiddenStreamersCount > 0">
                        <div class="streamer-avatar-wrapper">
                            <div class="streamer-avatar more-badge">+{{ hiddenStreamersCount }}</div>
                        </div>
                        <span class="streamer-name">autres</span>
                    </div>
                </div>
            </div>
        </div>

    </div>



    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="app.js"></script>
</body>

</html>