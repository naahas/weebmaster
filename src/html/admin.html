<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShonenMaster - Panel Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
</head>

<body>
    <!-- ============ LOGIN ============ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-logo">
                <h1>ShonenMaster Admin</h1>
                <p>Panel d'administration</p>
            </div>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Code d'acc√®s</label>
                    <input type="password" id="adminCode" placeholder="Entrez le code admin" required autofocus>
                </div>
                <button type="submit" class="btn-login">Se connecter</button>
                <div class="error-msg" id="errorMsg"></div>
            </form>
        </div>
    </div>

    <!-- ============ ADMIN PANEL ============ -->
    <div class="admin-panel" id="adminPanel">
        <!-- Header -->
        <div class="admin-header">
            <div style="display: flex; align-items: center; gap: 12px;">
                <button class="btn-home-icon" onclick="goToHome()" title="Retour √† l'accueil">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                    </svg>
                </button>
                <h1>ShonenMaster Admin</h1>
            </div>
            <div class="header-actions">
                <div class="status-badge">
                    <div class="status-dot inactive" id="statusIndicator"></div>
                    <span id="statusText">INACTIF</span>
                </div>
            </div>
        </div>

        <!-- Boutons de contr√¥le (100% width) -->
        <div class="control-buttons">
            <div class="control-card primary" id="toggleGameCard" onclick="toggleGame()">
                <h3 id="toggleGameBtn">Ouvrir lobby</h3>
            </div>
            <div class="control-card" id="startGameCard" onclick="startGame()">
                <h3>D√©marrer la partie</h3>
            </div>
            <div class="control-card" id="nextQuestionCard" onclick="nextQuestion()">
                <h3>Question suivante</h3>
            </div>
            <div class="control-card secondary" onclick="refreshPage()">
                <h3>Rafra√Æchir</h3>
            </div>


        </div>

        <!-- Layout 30/70 -->
        <div class="admin-content">
            <!-- ============ LEFT PANEL (Stats + Controls) ============ -->
            <div class="left-panel">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Lobby</div>
                        <div class="stat-value" id="playerCount">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Actifs</div>
                        <div class="stat-value success" id="activePlayers">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Question</div>
                        <div class="stat-value" id="currentQuestion">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Parties totales</div>
                        <div class="stat-value" id="totalGames">0</div>
                    </div>
                </div>

                <!-- Toggle Buttons -->
                <div class="toggle-buttons">
                    <button class="toggle-btn" onclick="toggleOverlay('top10')">
                        üèÜ Top 10 Joueurs
                    </button>
                    <button class="toggle-btn" onclick="toggleOverlay('recent')">
                        üìä Parties r√©centes
                    </button>
                </div>
            </div>

            <!-- ============ RIGHT PANEL (Question/Players) ============ -->
            <div class="right-panel">
                <!-- Tabs -->
                <div class="tabs-header">
                    <button class="tab-btn active" onclick="switchTab('question')">
                        Question en cours
                    </button>
                    <button class="tab-btn" onclick="switchTab('players')">
                        Grille joueurs
                    </button>
                </div>

                <!-- Tab: Question -->
                <div class="tab-content active" id="tabQuestion">
                    <div id="questionContainer">
                        <div class="empty-state">
                            <div class="empty-state-icon">‚ùì</div>
                            <h3>Aucune question active</h3>
                            <p>D√©marrez une partie pour afficher les questions</p>
                        </div>
                    </div>
                    <div id="resultsContainer" style="display: none;">
                        <!-- Results will be injected here -->
                    </div>
                </div>

                <!-- Tab: Players Grid -->
                <div class="tab-content" id="tabPlayers">
                    <div class="players-grid" id="playersGrid">
                        <div class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <h3>Aucun joueur</h3>
                            <p>Les joueurs appara√Ætront ici une fois la partie lanc√©e</p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- ============ SETTINGS PANEL (RIGHT) ============ -->
            <!-- ============ SETTINGS PANEL (RIGHT) ============ -->
            <div class="settings-panel">
                <!-- Overlay pour fermer le menu -->
                <div class="mode-menu-overlay" id="modeMenuOverlay" onclick="toggleModeMenu()"></div>

                <!-- Bouton Mode en haut -->
                <div class="mode-selector-container">
                    <button class="btn-mode-toggle" id="btnModeToggle" onclick="toggleModeMenu()">
                        <span class="mode-icon">‚öôÔ∏è</span>
                        <span class="mode-text" id="currentModeText">Mode Vie</span>
                        <span class="mode-arrow">‚ñº</span>
                    </button>

                    <!-- Menu d√©roulant des modes -->
                    <div class="mode-menu" id="modeMenu">
                        <div class="mode-option selected" onclick="selectMode('lives')">
                            <!-- <span class="mode-option-icon">‚ù§Ô∏è</span> -->
                            <span class="mode-option-text">Mode Vie</span>
                        </div>
                        <div class="mode-option" onclick="selectMode('points')">
                            <!-- <span class="mode-option-icon">‚≠ê</span> -->
                            <span class="mode-option-text">Mode Points</span>
                        </div>
                    </div>
                </div>

                <!-- Param√®tres de partie -->
                <div class="settings-section" id="gameSettings">
                    <!-- Sous-param√®tres Mode Vie -->
                    <div class="mode-params" id="livesParams">
                        <div class="setting-item">
                            <label class="setting-label">Nombre de vies</label>
                            <div class="lives-selector">
                                <button class="lives-btn" onclick="setLives(1)" id="lives-1">1</button>
                                <button class="lives-btn" onclick="setLives(2)" id="lives-2">2</button>
                                <button class="lives-btn active" onclick="setLives(3)" id="lives-3">3</button>
                            </div>
                        </div>
                    </div>

                    <!-- Sous-param√®tres Mode Points -->
                    <div class="mode-params" id="pointsParams" style="display: none;">
                        <div class="setting-item">
                            <label class="setting-label">Nombre de questions</label>
                            <div class="questions-grid">
                                <button class="questions-btn" onclick="setQuestions(3)" id="questions-3">3</button>
                                <button class="questions-btn active" onclick="setQuestions(20)"
                                    id="questions-20">20</button>
                                <button class="questions-btn" onclick="setQuestions(25)" id="questions-25">25</button>
                                <button class="questions-btn" onclick="setQuestions(30)" id="questions-30">30</button>
                                <button class="questions-btn" onclick="setQuestions(35)" id="questions-35">35</button>
                                <button class="questions-btn" onclick="setQuestions(40)" id="questions-40">40</button>
                                <button class="questions-btn" onclick="setQuestions(45)" id="questions-45">45</button>
                                <button class="questions-btn" onclick="setQuestions(50)" id="questions-50">50</button>
                            </div>
                        </div>
                    </div>


                    <!-- Param√®tres communs (toujours visibles) -->
                    <div class="setting-item">
                        <label class="setting-label">Temps par question</label>
                        <div class="time-selector">
                            <select class="time-select" id="timeSelect" onchange="setTime(this.value)">
                                <option value="5">5 secondes</option>
                                <option value="6">6 secondes</option>
                                <option value="7">7 secondes</option>
                                <option value="8">8 secondes</option>
                                <option value="9">9 secondes</option>
                                <option value="10" selected>10 secondes</option>
                                <option value="11">11 secondes</option>
                                <option value="12">12 secondes</option>
                                <option value="13">13 secondes</option>
                                <option value="14">14 secondes</option>
                                <option value="15">15 secondes</option>
                            </select>
                        </div>
                    </div>

                    <div class="setting-item">
                        <label class="setting-label">Nombre de r√©ponses</label>
                        <div class="lives-selector">
                            <button class="lives-btn active" onclick="setAnswers(4)" id="answers-4">4</button>
                            <button class="lives-btn" onclick="setAnswers(6)" id="answers-6">6</button>
                        </div>
                    </div>
                    <!-- üÜï Param√®tre Mode de difficult√© (commun aux 2 modes) -->
                    <div class="setting-item">
                        <label class="setting-label">Mode de difficult√©</label>
                        <button class="difficulty-mode-btn" id="difficultyModeBtn" onclick="toggleDifficultyMode()">
                            <span class="diff-mode-icon"></span>
                            <span class="diff-mode-text">Croissante</span>
                        </button>
                    </div>
                </div>


                <!-- Reset Questions & Signaler Question - C√îTE √Ä C√îTE -->
                <div class="reset-questions-section">
                    <button class="btn-reset-questions" id="btnResetQuestions" onclick="resetQuestionsHistory()">
                        <span class="reset-icon">‚ôªÔ∏è</span>
                        <span class="reset-text">Reset</span>
                    </button>

                    <button class="btn-report-question" id="btnReportQuestion" onclick="openReportModal()">
                        <span class="report-icon">‚ùó</span>
                        <span class="report-text">Signaler</span>
                    </button>
                </div>
            </div>
        </div>


        <!-- <div class="add-question-section"
            style="grid-column: 1 / -1; margin-top: 32px; padding: 24px; background: var(--bg-card); border-radius: 16px; border: 1px solid var(--border);">
            <h2 style="color: var(--primary); margin-bottom: 24px; font-size: 1.2rem;">‚ûï Ajouter une question</h2>

            <form id="addQuestionForm" style="display: grid; gap: 16px;">
                <div style="max-width: 600px;">
                    <label
                        style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">Question</label>
                    <input type="text" id="questionText" required
                        style="width: 100%; padding: 12px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                </div>

                <div style="display: grid; grid-template-columns: 1fr; gap: 12px; max-width: 600px;">
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">R√©ponse
                            1</label>
                        <input type="text" id="answer1" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">R√©ponse
                            2</label>
                        <input type="text" id="answer2" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">R√©ponse
                            3</label>
                        <input type="text" id="answer3" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">R√©ponse
                            4</label>
                        <input type="text" id="answer4" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">R√©ponse
                            5</label>
                        <input type="text" id="answer5" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">R√©ponse
                            6</label>
                        <input type="text" id="answer6" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px;">
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">Bonne
                            r√©ponse (1-6)</label>
                        <input type="number" id="correctAnswer" min="1" max="6" value="1" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">S√©rie</label>
                        <input type="text" id="serie" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                    </div>
                    <div>
                        <label
                            style="display: block; color: var(--text-secondary); font-size: 0.75rem; margin-bottom: 8px;">Difficult√©</label>
                        <select id="difficulty" required
                            style="width: 100%; padding: 10px; background: var(--bg-main); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-family: 'Poppins';">
                            <option value="veryeasy">Very Easy</option>
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                            <option value="veryhard">Very Hard</option>
                            <option value="extreme">Extreme</option>
                        </select>
                    </div>
                </div>

                <button type="submit"
                    style="padding: 12px 24px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: var(--bg-main); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; font-family: 'Poppins';">
                    Ajouter la question
                </button>
            </form>

            <div id="addQuestionStatus" style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;">
            </div>
        </div> -->
    </div>

    <!-- Overlay Backdrop -->
    <div class="overlay-backdrop" id="overlayBackdrop" onclick="closeOverlays()"></div>

    <!-- Overlay: Top 10 -->
    <div class="overlay-panel" id="overlayTop10">
        <div class="overlay-header">
            <h2>üèÜ Top 10 Joueurs</h2>
            <button class="close-overlay" onclick="closeOverlays()">‚úï</button>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Rang</th>
                    <th>Joueur</th>
                    <th>Victoires</th>
                    <th>Parties</th>
                </tr>
            </thead>
            <tbody id="topPlayersTable">
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        Aucune donn√©e disponible
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Overlay: Recent Games -->
    <div class="overlay-panel" id="overlayRecent">
        <div class="overlay-header">
            <h2>üìä Parties r√©centes</h2>
            <button class="close-overlay" onclick="closeOverlays()">‚úï</button>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Gagnant</th>
                    <th>Questions</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="recentGamesTable">
                <tr>
                    <td colspan="4" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                        Aucune donn√©e disponible
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <!-- Modal Signalement -->
    <div class="report-modal-overlay" id="reportModalOverlay" onclick="closeReportModal()">
        <div class="report-modal" onclick="event.stopPropagation()">
            <div class="report-modal-header">
                <h3>Demander un changement</h3>
                <button class="report-modal-close" onclick="closeReportModal()">‚úï</button>
            </div>

            <div class="report-modal-body">
                <p class="report-question-preview" id="reportQuestionPreview"></p>

                <div class="report-form-group">
                    <label for="reportReason">Motif du signalement</label>
                    <select id="reportReason" class="report-select">
                        <option value="Augmenter la difficult√©">Augmenter la difficult√©</option>
                        <option value="Baisser la difficult√©">Baisser la difficult√©</option>
                        <option value="Corriger la question / r√©ponses">Corriger la question / r√©ponses</option>
                        <option value="Changer la bonne r√©ponse">Changer la bonne r√©ponse</option>
                        <option value="Reformuler la question">Reformuler la question
                        </option>
                        <option value="Enlever doublon">Enlever doublon</option>
                        <!-- <option value="Autre">Autre</option>-->
                    </select>
                </div>
            </div>

            <div class="report-modal-footer">
                <button class="btn-report-cancel" onclick="closeReportModal()">Annuler</button>
                <button class="btn-report-submit" onclick="submitReport()">Signaler</button>
            </div>
        </div>
    </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast-notification" id="toastNotification">
        <span class="toast-icon">‚úì</span>
        <span class="toast-text">Question signal√©e avec succ√®s</span>
    </div>

    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="admin.js"></script>
</body>

</html>