<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeebMaster - Admin Panel</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'VT323', monospace;
            background: #0f0f23;
            color: #FFD700;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            background-image: 
                repeating-linear-gradient(0deg, rgba(255, 215, 0, 0.03) 0px, transparent 1px, transparent 2px, rgba(255, 215, 0, 0.03) 3px),
                repeating-linear-gradient(90deg, rgba(255, 215, 0, 0.03) 0px, transparent 1px, transparent 2px, rgba(255, 215, 0, 0.03) 3px);
        }

        .container {
            max-width: 1600px;
            width: 100%;
        }

        /* Login Form */
        .login-container {
            background: #1a1a2e;
            border: 3px solid #FFD700;
            padding: 40px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3), inset 0 0 20px rgba(255, 215, 0, 0.1);
            text-align: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .login-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            margin-bottom: 30px;
            text-shadow: 0 0 10px #FFD700;
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { text-shadow: 0 0 10px #FFD700; }
            50% { text-shadow: 0 0 20px #FFD700, 0 0 30px #FFD700; }
        }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            background: #0f0f23;
            border: 2px solid #FFD700;
            color: #FFD700;
            font-family: 'VT323', monospace;
            font-size: 1.2rem;
            outline: none;
            text-align: center;
        }

        .input-group input::placeholder {
            text-align: center;
        }

        .input-group input:focus {
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .btn {
            padding: 15px 40px;
            background: #FFD700;
            color: #0f0f23;
            border: none;
            font-family: 'VT323', monospace;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            font-weight: bold;
        }

        .btn:hover {
            background: #FFA500;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            transform: scale(1.05);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .error-msg {
            color: #ff0000;
            margin-top: 15px;
            font-size: 1.2rem;
        }

        /* Admin Panel */
        .admin-panel {
            display: none;
        }

        .panel-header {
            background: #1a1a2e;
            border: 3px solid #FFD700;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .panel-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 0 10px #FFD700;
        }

        .status-line {
            font-size: 1.3rem;
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 10px;
            animation: blink 1.5s infinite;
        }

        .status-indicator.active {
            background: #00ff00;
        }

        .status-indicator.inactive {
            background: #ff0000;
        }

        @keyframes blink {
            0%, 50%, 100% { opacity: 1; }
            25%, 75% { opacity: 0.3; }
        }

        .control-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-btn {
            padding: 15px;
            background: #1a1a2e;
            border: 3px solid #FFD700;
            color: #FFD700;
            font-family: 'VT323', monospace;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .control-btn:hover {
            background: #FFD700;
            color: #0f0f23;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .control-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Question en temps r√©el */
        .live-question-container {
            background: #1a1a2e;
            border: 3px solid #FFD700;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
            display: none;
        }

        .live-question-container.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #FFD700;
        }

        .question-meta {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .question-badge {
            background: #FFD700;
            color: #0f0f23;
            padding: 5px 15px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 20px #FFD700;
            animation: timerPulse 1s infinite;
        }

        .timer-display.warning {
            color: #ff0000;
            text-shadow: 0 0 20px #ff0000;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .question-text {
            font-size: 2rem;
            line-height: 1.6;
            margin: 20px 0;
            text-align: center;
        }

        .answers-tracker {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 20px;
            background: #0f0f23;
            border: 2px solid #FFD700;
        }

        .tracker-item {
            text-align: center;
        }

        .tracker-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #FFD700;
        }

        .tracker-label {
            font-size: 1.2rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* Onglets */
        .tabs-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: #1a1a2e;
            border: 3px solid #FFD700;
            color: #FFD700;
            font-family: 'VT323', monospace;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .tab-btn.active {
            background: #FFD700;
            color: #0f0f23;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Stats globales */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .result-box {
            background: #1a1a2e;
            border: 3px solid #FFD700;
            padding: 20px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .result-box h4 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 200px;
            gap: 15px;
        }

        .chart-bar {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .bar {
            width: 100%;
            min-height: 20px;
            border-radius: 8px 8px 0 0;
            position: relative;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding-top: 10px;
            transition: all 0.5s ease;
        }

        .bar.correct {
            background: linear-gradient(180deg, #00ff00, rgba(0, 255, 0, 0.5));
        }

        .bar.wrong {
            background: linear-gradient(180deg, #ff0000, rgba(255, 0, 0, 0.5));
        }

        .bar.afk {
            background: linear-gradient(180deg, #FFA500, rgba(255, 165, 0, 0.5));
        }

        .bar-value {
            font-weight: bold;
            font-size: 1.5rem;
            color: #fff;
        }

        .bar-label {
            font-size: 1.2rem;
            color: #FFD700;
        }

        .lives-distribution {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .life-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .life-icons {
            width: 100px;
            font-size: 1.2rem;
        }

        .life-bar {
            flex: 1;
            height: 30px;
            background: #0f0f23;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            border: 2px solid #FFD700;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            transition: width 0.5s ease;
        }

        .life-count {
            min-width: 40px;
            text-align: right;
            font-weight: bold;
            font-size: 1.3rem;
        }

        .elimination-info {
            background: #1a1a2e;
            border: 3px solid #ff0000;
            padding: 15px;
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .remaining-info {
            background: #1a1a2e;
            border: 3px solid #00ff00;
            padding: 15px;
            text-align: center;
            font-size: 1.5rem;
        }

        /* Grille de joueurs */
        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .player-card {
            background: #1a1a2e;
            border: 3px solid #FFD700;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .player-card.correct {
            border-color: #00ff00;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
            background: linear-gradient(135deg, #1a1a2e 0%, rgba(0, 255, 0, 0.1) 100%);
        }

        .player-card.wrong {
            border-color: #ff0000;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
            background: linear-gradient(135deg, #1a1a2e 0%, rgba(255, 0, 0, 0.1) 100%);
        }

        .player-card.afk {
            border-color: #FFA500;
            box-shadow: 0 0 20px rgba(255, 165, 0, 0.5);
            background: linear-gradient(135deg, #1a1a2e 0%, rgba(255, 165, 0, 0.1) 100%);
        }

        .player-card.eliminated {
            opacity: 0.5;
            border-color: #666;
        }

        .player-name {
            font-size: 1.5rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .player-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2rem;
        }

        .player-lives {
            font-size: 1.3rem;
        }

        .player-time {
            font-size: 1rem;
            opacity: 0.7;
        }

        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 2rem;
        }

        /* Stats dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #1a1a2e;
            border: 3px solid #FFD700;
            padding: 15px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
            text-align: center;
        }

        .stat-label {
            font-size: 1.1rem;
            opacity: 0.7;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            text-shadow: 0 0 10px #FFD700;
        }

        .tables-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .table-container {
            background: #1a1a2e;
            border: 3px solid #FFD700;
            padding: 15px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }

        .table-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px #FFD700;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            font-size: 1.2rem;
        }

        th {
            background: rgba(255, 215, 0, 0.1);
            font-weight: bold;
        }

        tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .rank-badge {
            display: inline-block;
            padding: 2px 8px;
            background: #FFD700;
            color: #0f0f23;
            font-weight: bold;
            border-radius: 3px;
        }

        .rank-badge.rank-1 { background: #FFD700; }
        .rank-badge.rank-2 { background: #C0C0C0; }
        .rank-badge.rank-3 { background: #CD7F32; }

        @media (max-width: 1200px) {
            .control-panel {
                grid-template-columns: repeat(2, 1fr);
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .tables-row {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Form -->
        <div id="loginForm" class="login-container">
            <div class="login-title">üéÆ ADMIN ACCESS üéÆ</div>
            <div class="input-group">
                <label for="password">ENTER PASSWORD:</label>
                <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="btn" onclick="login()">LOGIN</button>
            <div id="errorMsg" class="error-msg"></div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="admin-panel">
            <!-- Header -->
            <div class="panel-header">
                <div class="panel-title">üéÆ WEEBMASTER CONTROL PANEL üéÆ</div>
                <div class="status-line">
                    <span>GAME STATUS:</span>
                    <span>
                        <span id="statusText">INACTIVE</span>
                        <span class="status-indicator inactive" id="statusIndicator"></span>
                    </span>
                </div>
                <div class="status-line">
                    <span>PLAYERS IN LOBBY:</span>
                    <span id="playerCount">0</span>
                </div>
                <div class="status-line">
                    <span>GAME IN PROGRESS:</span>
                    <span id="gameProgress">NO</span>
                </div>
            </div>

            <!-- Controls -->
            <div class="control-panel">
                <button class="control-btn" id="toggleGameBtn" onclick="toggleGame()">
                    ACTIVATE GAME
                </button>
                <button class="control-btn" id="startGameBtn" onclick="startGame()" disabled>
                    START GAME
                </button>
                <button class="control-btn" id="nextQuestionBtn" onclick="nextQuestion()" disabled>
                    NEXT QUESTION
                </button>
                <button class="control-btn" onclick="refreshStats()">
                    REFRESH STATS
                </button>
            </div>

            <!-- Question en temps r√©el -->
            <div id="liveQuestionContainer" class="live-question-container">
                <div class="question-header">
                    <div class="question-meta">
                        <div class="question-badge" id="questionNumber">Q1</div>
                        <div class="question-badge" id="questionSerie">S√âRIE</div>
                        <div class="question-badge" id="questionDifficulty">EASY</div>
                    </div>
                    <div class="timer-display" id="liveTimer">7</div>
                </div>
                <div class="question-text" id="liveQuestionText">Question en cours...</div>
                <div class="answers-tracker">
                    <div class="tracker-item">
                        <div class="tracker-value" id="answeredCount">0</div>
                        <div class="tracker-label">ONT R√âPONDU</div>
                    </div>
                    <div class="tracker-item">
                        <div class="tracker-value" id="notAnsweredCount">0</div>
                        <div class="tracker-label">N'ONT PAS R√âPONDU</div>
                    </div>
                </div>
            </div>

            <!-- Onglets -->
            <div id="resultsTabsContainer" class="tabs-container" style="display: none;">
                <button class="tab-btn active" onclick="switchTab('stats')">
                    üìä STATS GLOBALES
                </button>
                <button class="tab-btn" onclick="switchTab('players')">
                    üë• JOUEURS
                </button>
            </div>

            <!-- Contenu des onglets -->
            <div id="tabStats" class="tab-content active">
                <!-- Stats globales (comme avant) -->
                <div id="questionResultsContainer" style="display: none;">
                    <div class="results-grid">
                        <div class="result-box">
                            <h4>üìä STATISTIQUES DES R√âPONSES</h4>
                            <div class="chart-container">
                                <div class="chart-bar">
                                    <div class="bar correct" id="barCorrect" style="height: 0%">
                                        <span class="bar-value" id="valueCorrect">0</span>
                                    </div>
                                    <div class="bar-label">BONNES</div>
                                </div>
                                <div class="chart-bar">
                                    <div class="bar wrong" id="barWrong" style="height: 0%">
                                        <span class="bar-value" id="valueWrong">0</span>
                                    </div>
                                    <div class="bar-label">MAUVAISES</div>
                                </div>
                                <div class="chart-bar">
                                    <div class="bar afk" id="barAfk" style="height: 0%">
                                        <span class="bar-value" id="valueAfk">0</span>
                                    </div>
                                    <div class="bar-label">AFK</div>
                                </div>
                            </div>
                        </div>

                        <div class="result-box">
                            <h4>‚ù§Ô∏è VIES RESTANTES</h4>
                            <div class="lives-distribution" id="livesDistribution">
                                <!-- Dynamique -->
                            </div>
                        </div>
                    </div>

                    <div class="elimination-info" id="eliminationInfo" style="display: none;">
                        üíÄ <span id="eliminatedCount">0</span> JOUEUR(S) √âLIMIN√â(S)
                    </div>

                    <div class="remaining-info">
                        üèÜ <span id="remainingCount">0</span> JOUEUR(S) EN VIE
                    </div>
                </div>
            </div>

            <div id="tabPlayers" class="tab-content">
                <div id="playersGridContainer" class="players-grid">
                    <!-- Dynamique -->
                </div>
            </div>

            <!-- Stats Dashboard -->
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">TOTAL GAMES</div>
                    <div class="stat-value" id="totalGames">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ACTIVE PLAYERS</div>
                    <div class="stat-value" id="activePlayers">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">CURRENT QUESTION</div>
                    <div class="stat-value" id="currentQuestion">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">ELIMINATED</div>
                    <div class="stat-value" id="totalEliminated">0</div>
                </div>
            </div>

            <!-- Tables -->
            <div class="tables-row">
                <div class="table-container">
                    <div class="table-title">TOP 10 PLAYERS</div>
                    <table>
                        <thead>
                            <tr>
                                <th>RANK</th>
                                <th>USERNAME</th>
                                <th>VICTORIES</th>
                                <th>GAMES</th>
                            </tr>
                        </thead>
                        <tbody id="topPlayersTable">
                            <tr><td colspan="4" style="text-align: center;">LOADING...</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="table-container">
                    <div class="table-title">RECENT GAMES</div>
                    <table>
                        <thead>
                            <tr>
                                <th>GAME ID</th>
                                <th>WINNER</th>
                                <th>QUESTIONS</th>
                                <th>DATE</th>
                            </tr>
                        </thead>
                        <tbody id="recentGamesTable">
                            <tr><td colspan="4" style="text-align: center;">LOADING...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script>
        let isAdmin = false;
        let statsInterval = null;
        let socket = null;
        let liveTimerInterval = null;
        let currentQuestionData = null;
        let playersData = new Map();

        // Check if already authenticated
        async function checkAuth() {
            try {
                const response = await fetch('/admin/check');
                const data = await response.json();
                if (data.isAdmin) {
                    showAdminPanel();
                    startStatsRefresh();
                    initSocket();
                }
            } catch (error) {
                console.error('Error checking auth:', error);
            }
        }

        async function login() {
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMsg');

            try {
                const response = await fetch('/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const data = await response.json();

                if (data.success) {
                    showAdminPanel();
                    startStatsRefresh();
                    initSocket();
                } else {
                    errorMsg.textContent = '‚úñ ACCESS DENIED';
                    setTimeout(() => errorMsg.textContent = '', 3000);
                }
            } catch (error) {
                errorMsg.textContent = '‚úñ CONNECTION ERROR';
                setTimeout(() => errorMsg.textContent = '', 3000);
            }
        }

        function showAdminPanel() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'block';
            isAdmin = true;
            refreshStats();
        }

        function initSocket() {
            socket = io();

            // Nouvelle question
            socket.on('new-question', (question) => {
                currentQuestionData = question;
                playersData.clear();
                showLiveQuestion(question);
                startLiveTimer();
                hideResults();
            });

            // R√©sultats de la question
            socket.on('question-results', (results) => {
                stopLiveTimer();
                hideLiveQuestion();
                showResults(results);
            });

            // Mise √† jour du lobby
            socket.on('lobby-update', (data) => {
                document.getElementById('playerCount').textContent = data.playerCount;
                updateAnswersTracker();
            });

            // Suivi des r√©ponses en temps r√©el (nouveau √©v√©nement √† ajouter c√¥t√© serveur)
            socket.on('answer-submitted', (data) => {
                playersData.set(data.socketId, data);
                updateAnswersTracker();
            });

            // Fin de partie
            socket.on('game-ended', () => {
                hideResults();
                hideLiveQuestion();
                stopLiveTimer();
            });
        }

        function showLiveQuestion(question) {
            const container = document.getElementById('liveQuestionContainer');
            document.getElementById('questionNumber').textContent = `Q${question.questionNumber}`;
            document.getElementById('questionSerie').textContent = question.serie;
            document.getElementById('questionDifficulty').textContent = question.difficulty.toUpperCase();
            document.getElementById('liveQuestionText').textContent = question.question;
            container.classList.add('active');
            document.getElementById('answeredCount').textContent = '0';
            const totalPlayers = parseInt(document.getElementById('playerCount').textContent);
            document.getElementById('notAnsweredCount').textContent = totalPlayers;
        }

        function hideLiveQuestion() {
            document.getElementById('liveQuestionContainer').classList.remove('active');
        }

        function startLiveTimer() {
            let timeLeft = 7;
            const timerElement = document.getElementById('liveTimer');
            
            timerElement.textContent = timeLeft;
            timerElement.classList.remove('warning');

            liveTimerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;

                if (timeLeft <= 3) {
                    timerElement.classList.add('warning');
                }

                if (timeLeft <= 0) {
                    stopLiveTimer();
                }
            }, 1000);
        }

        function stopLiveTimer() {
            if (liveTimerInterval) {
                clearInterval(liveTimerInterval);
                liveTimerInterval = null;
            }
        }

        function updateAnswersTracker() {
            const answered = playersData.size;
            const totalPlayers = parseInt(document.getElementById('playerCount').textContent);
            const notAnswered = Math.max(0, totalPlayers - answered);

            document.getElementById('answeredCount').textContent = answered;
            document.getElementById('notAnsweredCount').textContent = notAnswered;
        }

        function showResults(results) {
            document.getElementById('resultsTabsContainer').style.display = 'flex';
            document.getElementById('questionResultsContainer').style.display = 'block';

            // Mise √† jour des graphiques
            const max = Math.max(results.stats.correct, results.stats.wrong, results.stats.afk) || 1;
            
            document.getElementById('valueCorrect').textContent = results.stats.correct;
            document.getElementById('barCorrect').style.height = ((results.stats.correct / max) * 100) + '%';
            
            document.getElementById('valueWrong').textContent = results.stats.wrong;
            document.getElementById('barWrong').style.height = ((results.stats.wrong / max) * 100) + '%';
            
            document.getElementById('valueAfk').textContent = results.stats.afk;
            document.getElementById('barAfk').style.height = ((results.stats.afk / max) * 100) + '%';

            // Distribution des vies
            const livesDistribution = document.getElementById('livesDistribution');
            livesDistribution.innerHTML = '';
            const totalPlayers = Object.values(results.stats.livesDistribution).reduce((a, b) => a + b, 0);

            for (let lives = 3; lives >= 0; lives--) {
                const count = results.stats.livesDistribution[lives] || 0;
                const percentage = totalPlayers > 0 ? (count / totalPlayers) * 100 : 0;

                const hearts = '‚ù§Ô∏è'.repeat(lives) + 'üñ§'.repeat(3 - lives);
                
                livesDistribution.innerHTML += `
                    <div class="life-row">
                        <div class="life-icons">${hearts}</div>
                        <div class="life-bar">
                            <div class="bar-fill" style="width: ${percentage}%"></div>
                        </div>
                        <span class="life-count">${count}</span>
                    </div>
                `;
            }

            // √âliminations
            const eliminationInfo = document.getElementById('eliminationInfo');
            if (results.eliminatedCount > 0) {
                eliminationInfo.style.display = 'block';
                document.getElementById('eliminatedCount').textContent = results.eliminatedCount;
            } else {
                eliminationInfo.style.display = 'none';
            }

            document.getElementById('remainingCount').textContent = results.remainingPlayers;

            // Mise √† jour de la grille des joueurs
            updatePlayersGrid(results);

            // Stats globales
            document.getElementById('currentQuestion').textContent = currentQuestionData?.questionNumber || 0;
            document.getElementById('totalEliminated').textContent = results.eliminatedCount;
        }

        function updatePlayersGrid(results) {
            // Cette fonction sera aliment√©e par les donn√©es des joueurs
            // Pour l'instant, on cr√©e des cartes basiques
            const grid = document.getElementById('playersGridContainer');
            grid.innerHTML = '<div style="text-align: center; grid-column: 1/-1; padding: 40px; font-size: 1.5rem;">Donn√©es des joueurs disponibles apr√®s impl√©mentation Socket.io compl√®te</div>';
        }

        function hideResults() {
            document.getElementById('resultsTabsContainer').style.display = 'none';
            document.getElementById('questionResultsContainer').style.display = 'none';
        }

        function switchTab(tab) {
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Activer l'onglet s√©lectionn√©
            if (tab === 'stats') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('tabStats').classList.add('active');
            } else if (tab === 'players') {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('tabPlayers').classList.add('active');
            }
        }

        async function toggleGame() {
            try {
                const response = await fetch('/admin/toggle-game', { method: 'POST' });
                const data = await response.json();
                updateGameStatus(data.isActive);
            } catch (error) {
                console.error('Error toggling game:', error);
            }
        }

        async function startGame() {
            try {
                const response = await fetch('/admin/start-game', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    alert('‚úì GAME STARTED');
                    refreshStats();
                }
            } catch (error) {
                alert('‚úñ ERROR: ' + error.message);
            }
        }

        async function nextQuestion() {
            try {
                const response = await fetch('/admin/next-question', { method: 'POST' });
                const data = await response.json();
                if (data.success) {
                    console.log('‚úì Next question sent');
                }
            } catch (error) {
                alert('‚úñ ERROR: ' + error.message);
            }
        }

        async function refreshStats() {
            try {
                const response = await fetch('/admin/stats');
                const data = await response.json();

                document.getElementById('totalGames').textContent = data.totalGames;
                document.getElementById('playerCount').textContent = data.currentPlayers;
                document.getElementById('activePlayers').textContent = data.currentPlayers;
                document.getElementById('gameProgress').textContent = data.gameInProgress ? 'YES' : 'NO';

                updateGameStatus(data.gameActive);

                document.getElementById('startGameBtn').disabled = !data.gameActive || data.gameInProgress;
                document.getElementById('nextQuestionBtn').disabled = !data.gameInProgress;

                // Update top players
                const topPlayersTable = document.getElementById('topPlayersTable');
                if (data.topPlayers.length === 0) {
                    topPlayersTable.innerHTML = '<tr><td colspan="4" style="text-align: center;">NO DATA</td></tr>';
                } else {
                    topPlayersTable.innerHTML = data.topPlayers.map((player, index) => `
                        <tr>
                            <td><span class="rank-badge rank-${index + 1}">${index + 1}</span></td>
                            <td>${player.username}</td>
                            <td>${player.total_victories}</td>
                            <td>${player.total_games_played}</td>
                        </tr>
                    `).join('');
                }

                // Update recent games
                const recentGamesTable = document.getElementById('recentGamesTable');
                if (data.recentGames.length === 0) {
                    recentGamesTable.innerHTML = '<tr><td colspan="4" style="text-align: center;">NO DATA</td></tr>';
                } else {
                    recentGamesTable.innerHTML = data.recentGames.map(game => `
                        <tr>
                            <td>#${game.id}</td>
                            <td>${game.winner ? game.winner.username : 'N/A'}</td>
                            <td>${game.questions_count}</td>
                            <td>${new Date(game.created_at).toLocaleDateString()}</td>
                        </tr>
                    `).join('');
                }

            } catch (error) {
                console.error('Error refreshing stats:', error);
            }
        }

        function updateGameStatus(isActive) {
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.getElementById('statusIndicator');
            const toggleBtn = document.getElementById('toggleGameBtn');

            if (isActive) {
                statusText.textContent = 'ACTIVE';
                statusIndicator.classList.remove('inactive');
                statusIndicator.classList.add('active');
                toggleBtn.textContent = 'DEACTIVATE GAME';
            } else {
                statusText.textContent = 'INACTIVE';
                statusIndicator.classList.remove('active');
                statusIndicator.classList.add('inactive');
                toggleBtn.textContent = 'ACTIVATE GAME';
            }
        }

        function startStatsRefresh() {
            statsInterval = setInterval(refreshStats, 3000);
        }

        // Handle Enter key on login
        document.getElementById('password')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') login();
        });

        // Initialize
        checkAuth();
    </script>
</body>
</html>